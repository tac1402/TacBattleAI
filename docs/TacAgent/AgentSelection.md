---
title: AgentSelection
---

Компонент __AgentSelection__ управляет визуальным выбором агента [Agent](../../TacAgent/Agent) с помощью наличия у него префаба с компонентом [StatusBar](../../TacAgent/StatusBar) во время щелчка мыши. Чтобы словить щелчек мыши, расширяется компонент [TopCamera](../../TacCamera/TopCamera). 

Сам компонент __AgentSelection__ является управляющим, т.е. как правило весит в корне сцены, например на геймобъекте с названием __World__. При этом для функционирования свойство __TopCamera__ должно быть заполнено прямо путем перетягивания в сцене юнити или программно.  

## Расширение компонента TopCamera

Для реализации своей функциональности компонент __AgentSelection__ __сам__ (код находится в этом же файле, что и сам класс) дополняет компонент TopCamera описанными ниже членами, часть описания приведенно лишь для понимания логики работы компонента и помечено как _onlyforread_, т.к. всю эту функциональность конечному разработчику использовать не нужно. Единственно, что требуется от разработчика - это задать значение свойства слоя агентов у камеры (TopCamera.AgentLayer).

### TopCamera.AgentLayer
_LayerMask AgentLayer_

Слой агентов, рейкастя который можно отличить агентов от других слоев.

### InitAgent 
_bool InitAgent_ (_onlyforread_)

Компонент __AgentSelection__ сам используя свой метод Awake() инициализирует возможность выбора агента (InitAgent = true), и подписывается на событие _OnAgentTap_, которое сам же расширяет в _TopCamera_ и сам же его будет вызывать.

### TopCamera.OnAgentTap 
_event AgentInfo OnAgentTap_ (_onlyforread_ __+__)

Перехватывая событие камеры OnUpdate, будет ловится нажатие левой кнопки мыши и вызыватсья метод GetAgent(), который может возвратит агента. В случае успеха будет вызвано событие OnAgentTap со "словленным" агентом, иначе событие OnAgentTap так же возникнет при назатии на левую кнопку мыши, но только со значением =null.

### TopCamera.GetAgent()
_GameObject GetAgent(Vector2 touch)_ (_onlyforread_ __+__)

Используя координаты нажатия левой кнопки мыши (_touch_) создаст луч от камеры и сделает рейкаст с попыткой обнаружить объект помеченный как уровень агента (_AgentLayer_). Метод используется для обработки события _OnAgentTap_, но может использовать и разработчиком, для получения агента по соответствующим координатам. Например, если его нужно получить по какому то другому принципу, а не по нажатию левой кнопки мыши.

## Расширение компонента Agent
Для реализации своей функциональности компонент __AgentSelection__ __сам__  расширяет компонент Agent единственным свойством _GameObject SelectionUI_, которое в зависимости от префаба агента, должно быть в нем задано ссылаясь на юнити-объект, который визуализирует выбранного агента (в префабе по умолчанию - зеленная окружность в виде цели).

## SelectedAgent
_Agent SelectedAgent_ (_onlyforread_ __+__)

Компонент __AgentSelection__ самостоятельно обеспечивает наличие в этом свойстве выбранного агента. Если агент перестает быть выбраным посылает событие прошлому агенту OnAgentDeselect, и если выбирается новый агент посылает событие OnAgentSelect. Перед событием OnAgentSelect обеспечивает инициализацию у этого агента его статус бара и выполняет дефолтную обработку показывая или скрывая визуальный выбор агента окружностью (подробнее см. [StatusBar](../../TacAgent/StatusBar)).

